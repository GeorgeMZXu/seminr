---
title: "modelr"
author: "Soumya Ray & Nicholas Danks"
date: "August 26, 2016"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{modelR}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

# modelr

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse = T, comment = "#>")
library(modelr)
data("mobi", package = "semPLS")
```

There are now many packages available for R to build, estimate and make predictions
on PLS SEM models. However, the syntax of these models is disparate and complicated
and often discourages practitioners from use.

The goal of modelr is to provide a natural syntax for researchers to describe PLS 
structural equation models and that provides functionality across many different 
PLS SEM estimation and prediction packages, such as semPLS, matrixPLS and simplePLS.

The description of the model often takes longer and requires dozens of lines of code,
however modelr seeks to automate this process and make modelling such features as 
interactions and mediations much simpler.

There are 3 basic steps in the PLS SEM model description:

* Describe the structural (inner) model

* Describe the measurement (outer) model

* Describe interactions

The modelr package makes these steps fast and easy:

* By providing easily readable and writable syntax, describing the model becomes simpler -
 and you can quickly change paths and structures allowing for multiple model comparisons.

* It provides simple "verbs", functions that correspond to the most common data manipulation tasks, to help you translate those thoughts into code.

* It automates such tedious tasks as creating interaction terms which usually require multiple lines of code and can be difficult to read and follow.

This document introduces you to modelr's basic set of tools, and shows you how to apply them to your models. Other vignettes provide more details on specific topics:

* vignette#2: bla bla bla

* vignette#3: bla bla bla

## Data: 'mobi' from semPLS package

To explore the basic syntax of modelr, we'll start with the data bundled with the semPLS package - `mobi` data frame. The data set is used as measurement instrument for the european customer satisfaction index (ECSI) adapted to the mobile phone market, see Tenenhaus et al. (2005).

```{r}
data("mobi", package = "semPLS")
dim(mobi)
head(mobi)
```

PLS SEM estimation and prediction packages generally take a source - target type matrix as parameters for each of the structural model and the measurement model. They require the practitioner to create any interaction terms by hand prior to model description. Modelr makes use of simple and natural verbs to describe the model.

## Measurement model description verbs

Modelr verbs for measurement model description:

* `multi_items()`
* `reflect()` (or `form()`)
* `measure()` 

These verbs are highly intuitive and provide for human-readable code that allows a practitioner to understand a measurement model on first glance and easily make changes to compare different measurement models.

### Describe multiple measurement items (manifest variables) with `multi_items()` or single item measurement items with `single_item()`

`single_item()` provides a verb to describe a single measurement item, while 
`multi_items()` provides a verb to describe multiple measurement items in one simple line of human-readable code. 

For example, we can describe the manifest variables: IMAG1, IMAG2, IMAG3, IMAG4 and IMAG5:

```{r}
multi_items("IMAG", 1:5)
```

This is equivalent to the more verbose code in base R:

```{r, eval = FALSE}
c("IMAG1", "IMAG2", "IMAG3", "IMAG4", "IMAG5")
```

`multi_items()` is used in conjunction with `reflect()` or `form()` to describe a factor.

### Describe a factor with `form()` or `reflect()`

`form()` and `reflect()` provide a verb to describe a factor in one simple line of human-readable code. 

For example, we can describe the reflective factor "Image" with manifest variables IMAG1, IMAG2, IMAG3, IMAG4 and IMAG5:

```{r}
reflect("Image", multi_items("IMAG", 1:5))
```

or

```{r}
form("Image", multi_items("IMAG", 1:5))
```

This is equivalent to the more verbose code in base R:

```{r, eval = FALSE}
c("Image", "IMAG1", "Image", "IMAG2", "Image", "IMAG3", "Image", "IMAG4", "Image", "IMAG5")
```

for reflective factors or:

```{r, eval = FALSE}
c("IMAG1", "Image", "IMAG2", "Image", "IMAG3", "Image", "IMAG4", "Image", "IMAG5", "Image")
```

for formative factors.

`multi_items()` is used in conjunction with `reflect()` or `form()` to describe a factor. 
`measure()` is used in conjunction with multiple factor descriptions to describe the entire measurement model.

### Create measurement model matrix with `measure()`

`measure()` compiles the measurement model source-target matrix from the user specified factor descriptions described in the parameters.

For example, we can create a source-target matrix measurement model for the `mobi` data:

```{r}
mobi_mm <- measure(
  reflect("Image",        multi_items("IMAG", 1:5)),
  reflect("Expectation",  multi_items("CUEX", 1:3)),
  reflect("Quality",      multi_items("PERQ", 1:7)),
  reflect("Value",        multi_items("PERV", 1:2)),
  form("Satisfaction",    multi_items("CUSA", 1:3)),
  form("Complaints",      single_item("CUSCO")),
  form("Loyalty",         multi_items("CUSL", 1:3))
)
```

The output of this code is:

```{r}
mobi_mm
```

This is equivalent to the more verbose code in base R:

```{r, eval = FALSE}
mobi_mm <- matrix(c("Image","IMAG1",
                    "Image","IMAG2",
                    "Image","IMAG3",
                    "Image","IMAG4",
                    "Image","IMAG5",
                    "Expectation","CUEX1",
                    "Expectation","CUEX2",
                    "Expectation","CUEX3",
                    "Quality", "PERQ1",
                    "Quality", "PERQ2",
                    "Quality", "PERQ3",
                    "Quality", "PERQ4",
                    "Quality", "PERQ5",
                    "Quality", "PERQ6",
                    "Quality", "PERQ7",
                    "Value","PERV1",
                    "Value","PERV2",
                    "CUSA1", "Satisfaction",
                    "CUSA2", "Satisfaction",
                    "CUSA3", "Satisfaction",
                    "CUSCO", "Complaints",
                    "CUSL1", "Loyalty",
                    "CUSL2", "Loyalty",
                    "CUSL3", "Loyalty"),nrow=24,ncol=2,byrow =TRUE,
                   dimnames = list(1:24,c("source","target")))
```

That was a mouthful of code! The `modelr()` syntax is far more human-readable and the use of the verbs really makes the meaning explicit. Modifications to the `modelr()` measurement model description are quick and easy and intuitive. 

